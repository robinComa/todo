"use strict";angular.module("taskApp",["taskApp.services.task","taskApp.directives.editable","taskApp.filters.dateDelta","google"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/tasks",{templateUrl:"views/tasks.html",controller:"TasksCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("taskApp").controller("LoginCtrl",["$rootScope","$location","Google","Task",function(a,b,c,d){c.login(function(){a.$apply(function(){d.initAccount(c.getUser().id),b.path("tasks")})})}]),angular.module("taskApp").controller("TasksCtrl",["$scope","$location","Task","Google",function(a,b,c,d){null==d.getUser()&&b.path("/"),a.user=d.getUser(),c.onValues(function(b){a.tasks=b}),a.addTask=function(){c.add({date:(new Date).getTime(),text:this.newTask}),this.newTask=""},a.getTaskIdByIndex=function(b){var c=0;for(var d in a.tasks){if(b==c)return d;c++}return null},a.setTaskDone=function(b){var d=!a.tasks[b].done;a.tasks[b].done=d,c.setDone(b,d)},a.removeTask=function(b){delete a.tasks[b],c.remove(b)},a.setTaskText=function(a,b){c.setText(a,b)}}]),angular.module("taskApp.services.task",[]).factory("Task",["$rootScope",function(a){var b,c=!0;return{initAccount:function(a){b=new Firebase("https://to-do.firebaseio.com/"+a)},onValues:function(d){b.on("value",function(b){null!==b.val()&&(c?a.$apply(function(){d(b.val())}):d(b.val())),c=!1})},add:function(a){b.push(a)},remove:function(a){b.child(a).remove()},setDone:function(a,c){b.child(a).update({done:c})},setText:function(a,c){b.child(a).update({text:c})}}}]),angular.module("taskApp.directives.editable",["ui"]).directive("editable",function(){return{restrict:"E",replace:!0,scope:{model:"=model",changed:"&"},templateUrl:"views/editable.html",controller:["$scope",function(){}],link:function(a,b){a.editorEnabled=!1,a.unEdit=function(b){a.model=angular.copy(a.editModel),a.editorEnabled=!1,null!=b&&b.preventDefault(),a.changed()},a.enableEditor=function(){a.editModel=angular.copy(a.model),a.editorEnabled=!0,timer=setTimeout(function(){b.find("input").focus().select()},200)}}}}),angular.module("taskApp.filters.dateDelta",[]).filter("dateDelta",["$rootScope",function(){return function(a){var b="",c=6e4,d=60*c,e=24*d,f=30*e,g=365*e,h=(new Date).getTime()-parseInt(a);return b=h>g?Math.floor(new Date(h)/g)+" y":h>f?Math.floor(new Date(h)/f)+" m":h>e?Math.floor(new Date(h)/e)+" d":h>d?Math.floor(new Date(h)/d)+" h":h>c?Math.floor(new Date(h)/c)+" m":"now"}}]),angular.module("google",[]).factory("Google",["$rootScope",function(){var a,b=!1;!function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/client:plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),window.signinCallback=function(a){a.access_token?(document.getElementById("signinButton").setAttribute("style","display: none"),b=!0):a.error&&console.log("There was an error: "+a.error)};var c=function(a){var c=setInterval(function(){b&&(a(),clearInterval(c))},10)};return{isReady:function(a){c(a)},login:function(b){c(function(){gapi.client.load("plus","v1",function(){var c=gapi.client.plus.people.get({userId:"me"});c.execute(function(c){a=c,b()})})})},getUser:function(){return a}}}]);